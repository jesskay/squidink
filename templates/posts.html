{% extends "base.html" %}
{% block title %}{% if title == "" %}{{ g.site_name }}{% else %}{{ title }} :: {{ g.site_name }}{% endif %}{% endblock %}
{% block content_body %}
<section id="posts">
    {% if posts %}
    {% for post in posts %}
    <article class="post">
        <header>
            {% if multi_post %}
            <h2><a href="{{ url_for("show_post", post_id=post.id) }}">{{ post.title }}</a></h2>
            {% else %}
            <h2>{{ post.title }}</h2>
            {% endif %}
            <p>posted by {{ post.author }} at <time datetime="{{ post.timestamp }}">{{ post.fancytime }}</time>
            {% if multi_post %}
            |
            <a href="{{ url_for("show_post", post_id=post.id) }}#comments">
            {% if post.num_comments == 0 %}
            no comments
            {% elif post.num_comments == 1 %}
            1 comment
            {% else %}
            {{ post.num_comments }} comments
            {% endif %}
            </a>
            {% endif %}
            {% if g.user_is_admin %}
            | <a href="{{ url_for("edit_post", post_id=post.id) }}">edit</a>
            | <a href="{{ url_for("delete_post", post_id=post.id) }}">delete</a>
            {% endif %}
            </p>
        </header>
        {{ post.body|safe }}
        {% if not multi_post %}
        <section id="comments">
            <header>
                <a id="comments"></a>
                <h3>Comments ({{ post.num_comments }})</h3>
            </header>
            {% if post.comments %}
            {% for comment in post.comments %}
            <article class="comment">
                <header>
                    <a id="comment-{{ comment.id }}"></a>
                    <p>{{ comment.author }} said, at <time datetime="{{comment.timestamp}}">{{ comment.fancytime }}</time>
                    {% if g.user_is_admin %}
                    | <a href="{{ url_for("delete_comment", post_id=post.id, comment_id=comment.id) }}">delete</a>
                    {% endif %}
                    | <a href="#comment-{{ comment.id }}">permalink</a></p>
                </header>
                {{ comment.text|safe }}
            </article>
            {% endfor %}
            {% else %}
            <p>No comments yet.</p>
            {% endif %}
            {% if g.logged_in %}
            <a id="new-comment"></a>
            <h4>Post your own comment:</h4>
            {% if comment_error %}
            <p class="error">{{ comment_error }}</p>
            {% endif %}
            <form action="{{ url_for("post_comment", post_id=post.id) }}" method="post">
                <textarea name="comment">{{ preset_comment }}</textarea>
                <button type="submit" name="submit">Post comment</button>
            </form>
            {% else %}
            <p><em>To post a comment, you'll need to <a href="{{ url_for("new_user") }}">get an account</a>.</em></p>
            {% endif %}
        </section>
        {% endif %}
    </article>
    {% endfor %}
    {% if nav_newer or nav_older %}
    <nav>
        {% if nav_newer %}
        <a href="{{ nav_newer }}" class="nav_newer">&larr; Newer posts</a>
        {% endif %}
        &nbsp; <!-- need non-absolute element to get full size box -->
        {% if nav_older %}
        <a href="{{ nav_older }}" class="nav_older">Older posts &rarr;</a>
        {% endif %}
    </nav>
    {% endif %}
    {% else %}
    <p>No posts here.</p>
    {% endif %}
</section>
{% endblock %}
